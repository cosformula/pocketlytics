"use strict";(()=>{var Me=Object.defineProperty;var Ae=(i,e,t)=>e in i?Me(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var f=(i,e,t)=>Ae(i,typeof e!="symbol"?e+"":e,t);function Le(i){let e="__DOUBLE_ASTERISK_TOKEN__",t="__SINGLE_ASTERISK_TOKEN__",n=i.replace(/\*\*/g,e).replace(/\*/g,t).replace(/[.+?^${}()|[\]\\]/g,"\\$&");n=n.replace(new RegExp(`/${e}/`,"g"),"/(?:.+/)?"),n=n.replace(new RegExp(e,"g"),".*"),n=n.replace(/\//g,"\\/");let o=n.replace(new RegExp(t,"g"),"[^/]+");return new RegExp("^"+o+"$")}function O(i,e){for(let t of e)try{if(Le(t).test(i))return t}catch(r){console.error(`Invalid pattern: ${t}`,r)}return null}function te(i,e){let t=null;return(...r)=>{t&&clearTimeout(t),t=setTimeout(()=>i(...r),e)}}function re(i){try{let e=window.location.hostname,t=new URL(i).hostname;return t!==e&&t!==""}catch{return!1}}function m(i,e){if(!i)return e;try{let t=JSON.parse(i);return Array.isArray(e)&&!Array.isArray(t)?e:t}catch(t){return console.error("Error parsing JSON:",t),e}}async function ie(i){let e=i.getAttribute("src");if(!e)return console.error("Script src attribute is missing"),null;let t=e.split("/script.js")[0];if(!t)return console.error("Please provide a valid analytics host"),null;let r=i.getAttribute("data-site-id")||i.getAttribute("site-id");if(!r)return console.error("Please provide a valid site ID using the data-site-id attribute"),null;let n=i.getAttribute("data-namespace")||"rybbit",o=m(i.getAttribute("data-skip-patterns"),[]),l=m(i.getAttribute("data-mask-patterns"),[]),c=m(i.getAttribute("data-replay-mask-text-selectors"),[]),s=i.getAttribute("data-debounce")?Math.max(0,parseInt(i.getAttribute("data-debounce"))):500,a=i.getAttribute("data-replay-batch-size")?Math.max(1,parseInt(i.getAttribute("data-replay-batch-size"))):250,d=i.getAttribute("data-replay-batch-interval")?Math.max(1e3,parseInt(i.getAttribute("data-replay-batch-interval"))):5e3,T=i.getAttribute("data-replay-block-class")||void 0,b=i.getAttribute("data-replay-block-selector")||void 0,B=i.getAttribute("data-replay-ignore-class")||void 0,Re=i.getAttribute("data-replay-ignore-selector")||void 0,Te=i.getAttribute("data-replay-mask-text-class")||void 0,q=i.getAttribute("data-replay-mask-all-inputs"),Se=q!==null?q!=="false":void 0,G=i.getAttribute("data-replay-mask-input-options"),Ce=G?m(G,{password:!0,email:!0}):void 0,Q=i.getAttribute("data-replay-collect-fonts"),we=Q!==null?Q!=="false":void 0,Y=i.getAttribute("data-replay-sampling"),Ee=Y?m(Y,{}):void 0,X=i.getAttribute("data-replay-slim-dom-options"),Pe=X?m(X,{}):void 0,Z=i.getAttribute("data-replay-sample-rate"),Ie=Z?Math.min(100,Math.max(0,parseInt(Z,10))):void 0,u={namespace:n,analyticsHost:t,siteId:r,debounceDuration:s,sessionReplayBatchSize:a,sessionReplayBatchInterval:d,sessionReplayMaskTextSelectors:c,skipPatterns:o,maskPatterns:l,autoTrackPageview:!0,autoTrackSpa:!0,trackQuerystring:!0,trackOutbound:!0,enableWebVitals:!1,trackErrors:!1,enableSessionReplay:!1,trackButtonClicks:!1,trackCopy:!1,trackFormInteractions:!1,sessionReplayBlockClass:T,sessionReplayBlockSelector:b,sessionReplayIgnoreClass:B,sessionReplayIgnoreSelector:Re,sessionReplayMaskTextClass:Te,sessionReplayMaskAllInputs:Se,sessionReplayMaskInputOptions:Ce,sessionReplayCollectFonts:we,sessionReplaySampling:Ee,sessionReplaySlimDOMOptions:Pe,sessionReplaySampleRate:Ie};try{let x=`${t}/site/tracking-config/${r}`,ee=await fetch(x,{method:"GET",credentials:"omit"});if(ee.ok){let p=await ee.json();return{...u,autoTrackPageview:p.trackInitialPageView??u.autoTrackPageview,autoTrackSpa:p.trackSpaNavigation??u.autoTrackSpa,trackQuerystring:p.trackUrlParams??u.trackQuerystring,trackOutbound:p.trackOutbound??u.trackOutbound,enableWebVitals:p.webVitals??u.enableWebVitals,trackErrors:p.trackErrors??u.trackErrors,enableSessionReplay:p.sessionReplay??u.enableSessionReplay,trackButtonClicks:p.trackButtonClicks??u.trackButtonClicks,trackCopy:p.trackCopy??u.trackCopy,trackFormInteractions:p.trackFormInteractions??u.trackFormInteractions}}else return console.warn("Failed to fetch tracking config from API, using defaults"),u}catch(x){return console.warn("Error fetching tracking config:",x),u}}var ne="rybbit-replay-sampled";function Be(i){if(i>=100)return!0;if(i<=0)return!1;try{let e=sessionStorage.getItem(ne);if(e!==null)return e==="1";let t=Math.random()*100<i;return sessionStorage.setItem(ne,t?"1":"0"),t}catch{return Math.random()*100<i}}var S=class{constructor(e,t,r){this.isRecording=!1;this.eventBuffer=[];this.config=e,this.userId=t,this.sendBatch=r}async initialize(){if(!this.config.enableSessionReplay)return;let e=this.config.sessionReplaySampleRate;e!==void 0&&!Be(e)||(window.rrweb||await this.loadRrweb(),window.rrweb&&this.startRecording())}async loadRrweb(){return new Promise((e,t)=>{let r=document.createElement("script");r.src=`${this.config.analyticsHost}/replay.js`,r.async=!1,r.onload=()=>{e()},r.onerror=()=>t(new Error("Failed to load rrweb")),document.head.appendChild(r)})}startRecording(){if(!(this.isRecording||!window.rrweb||!this.config.enableSessionReplay))try{let e={mousemove:!1,mouseInteraction:{MouseUp:!1,MouseDown:!1,Click:!0,ContextMenu:!1,DblClick:!0,Focus:!0,Blur:!0,TouchStart:!1,TouchEnd:!1},scroll:500,input:"last",media:800},t={script:!1,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0},r={emit:n=>{this.addEvent({type:n.type,data:n.data,timestamp:n.timestamp||Date.now()})},recordCanvas:!1,checkoutEveryNms:6e4,checkoutEveryNth:500,blockClass:this.config.sessionReplayBlockClass??"rr-block",blockSelector:this.config.sessionReplayBlockSelector??null,ignoreClass:this.config.sessionReplayIgnoreClass??"rr-ignore",ignoreSelector:this.config.sessionReplayIgnoreSelector??null,maskTextClass:this.config.sessionReplayMaskTextClass??"rr-mask",maskAllInputs:this.config.sessionReplayMaskAllInputs??!0,maskInputOptions:this.config.sessionReplayMaskInputOptions??{password:!0,email:!0},collectFonts:this.config.sessionReplayCollectFonts??!0,sampling:this.config.sessionReplaySampling??e,slimDOMOptions:this.config.sessionReplaySlimDOMOptions??t};this.config.sessionReplayMaskTextSelectors&&this.config.sessionReplayMaskTextSelectors.length>0&&(r.maskTextSelector=this.config.sessionReplayMaskTextSelectors.join(", ")),this.stopRecordingFn=window.rrweb.record(r),this.isRecording=!0,this.setupBatchTimer()}catch{}}stopRecording(){this.isRecording&&(this.stopRecordingFn&&this.stopRecordingFn(),this.isRecording=!1,this.clearBatchTimer(),this.eventBuffer.length>0&&this.flushEvents())}isActive(){return this.isRecording}addEvent(e){this.eventBuffer.push(e),this.eventBuffer.length>=this.config.sessionReplayBatchSize&&this.flushEvents()}setupBatchTimer(){this.clearBatchTimer(),this.batchTimer=window.setInterval(()=>{this.eventBuffer.length>0&&this.flushEvents()},this.config.sessionReplayBatchInterval)}clearBatchTimer(){this.batchTimer&&(clearInterval(this.batchTimer),this.batchTimer=void 0)}async flushEvents(){if(this.eventBuffer.length===0)return;let e=[...this.eventBuffer];this.eventBuffer=[];let t={userId:this.userId,events:e,metadata:{pageUrl:window.location.href,viewportWidth:screen.width,viewportHeight:screen.height,language:navigator.language}};try{await this.sendBatch(t)}catch{this.eventBuffer.unshift(...e)}}updateUserId(e){this.userId=e}onPageChange(){this.isRecording&&this.flushEvents()}cleanup(){this.stopRecording()}};var C=class{constructor(e){this.customUserId=null;this.config=e,this.loadUserId(),e.enableSessionReplay&&this.initializeSessionReplay()}loadUserId(){try{let e=localStorage.getItem(`${this.config.namespace}-user-id`);e&&(this.customUserId=e)}catch{}}async initializeSessionReplay(){try{this.sessionReplayRecorder=new S(this.config,this.customUserId||"",e=>this.sendSessionReplayBatch(e)),await this.sessionReplayRecorder.initialize()}catch(e){console.error("Failed to initialize session replay:",e)}}async sendSessionReplayBatch(e){try{await fetch(`${this.config.analyticsHost}/session-replay/record/${this.config.siteId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!1})}catch(t){throw console.error("Failed to send session replay batch:",t),t}}createBasePayload(){let e=new URL(window.location.href),t=e.pathname;if(e.hash&&e.hash.startsWith("#/")&&(t=e.hash.substring(1)),O(t,this.config.skipPatterns))return null;let r=O(t,this.config.maskPatterns);r&&(t=r);let n={site_id:this.config.siteId,hostname:e.hostname,pathname:t,querystring:this.config.trackQuerystring?e.search:"",screenWidth:screen.width,screenHeight:screen.height,language:navigator.language,page_title:document.title,referrer:document.referrer};return this.customUserId&&(n.user_id=this.customUserId),n}async sendTrackingData(e){try{await fetch(`${this.config.analyticsHost}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!0})}catch(t){console.error("Failed to send tracking data:",t)}}track(e,t="",r={}){if(e==="custom_event"&&(!t||typeof t!="string")){console.error("Event name is required and must be a string for custom events");return}let n=this.createBasePayload();if(!n)return;let l={...n,type:e,event_name:t,properties:["custom_event","outbound","error","button_click","copy","form_submit","input_change"].includes(e)?JSON.stringify(r):void 0};this.sendTrackingData(l)}trackPageview(){this.track("pageview")}trackEvent(e,t={}){this.track("custom_event",e,t)}trackOutbound(e,t="",r="_self"){this.track("outbound","",{url:e,text:t,target:r})}trackWebVitals(e){let t=this.createBasePayload();if(!t)return;let r={...t,type:"performance",event_name:"web-vitals",...e};this.sendTrackingData(r)}trackError(e,t={}){let r=window.location.origin,n=t.filename||"",o=e.stack||"";if(n)try{if(new URL(n).origin!==r)return}catch{}else if(o&&!o.includes(r))return;let l={message:e.message?.substring(0,500)||"Unknown error",stack:o.substring(0,2e3)||""};if(n&&(l.fileName=n),t.lineno){let c=typeof t.lineno=="string"?parseInt(t.lineno,10):t.lineno;c&&c!==0&&(l.lineNumber=c)}if(t.colno){let c=typeof t.colno=="string"?parseInt(t.colno,10):t.colno;c&&c!==0&&(l.columnNumber=c)}for(let c in t)!["lineno","colno"].includes(c)&&t[c]!==void 0&&(l[c]=t[c]);this.track("error",e.name||"Error",l)}trackButtonClick(e){this.track("button_click","",e)}trackCopy(e){this.track("copy","",e)}trackFormSubmit(e){this.track("form_submit","",e)}trackInputChange(e){this.track("input_change","",e)}identify(e,t){if(typeof e!="string"||e.trim()===""){console.error("User ID must be a non-empty string");return}this.customUserId=e.trim();try{localStorage.setItem(`${this.config.namespace}-user-id`,this.customUserId)}catch{console.warn("Could not persist user ID to localStorage")}this.sendIdentifyEvent(this.customUserId,t,!0),this.sessionReplayRecorder&&this.sessionReplayRecorder.updateUserId(this.customUserId)}setTraits(e){if(!e||typeof e!="object"){console.error("Traits must be an object");return}let t=this.customUserId;if(!t){console.warn("Cannot set traits without identifying user first. Call identify() first.");return}this.sendIdentifyEvent(t,e,!1)}async sendIdentifyEvent(e,t,r=!0){try{await fetch(`${this.config.analyticsHost}/identify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site_id:this.config.siteId,user_id:e,traits:t,is_new_identify:r}),mode:"cors",keepalive:!0})}catch(n){console.error("Failed to send identify event:",n)}}clearUserId(){this.customUserId=null;try{localStorage.removeItem(`${this.config.namespace}-user-id`)}catch{}}getUserId(){return this.customUserId}startSessionReplay(){this.sessionReplayRecorder?this.sessionReplayRecorder.startRecording():console.warn("Session replay not initialized")}stopSessionReplay(){this.sessionReplayRecorder&&this.sessionReplayRecorder.stopRecording()}isSessionReplayActive(){return this.sessionReplayRecorder?.isActive()??!1}onPageChange(){this.sessionReplayRecorder&&this.sessionReplayRecorder.onPageChange()}cleanup(){this.sessionReplayRecorder&&this.sessionReplayRecorder.cleanup()}};var he=-1,v=i=>{addEventListener("pageshow",(e=>{e.persisted&&(he=e.timeStamp,i(e))}),!0)},h=(i,e,t,r)=>{let n,o;return l=>{e.value>=0&&(l||r)&&(o=e.value-(n??0),(o||n===void 0)&&(n=e.value,e.delta=o,e.rating=((c,s)=>c>s[1]?"poor":c>s[0]?"needs-improvement":"good")(e.value,t),i(e)))}},V=i=>{requestAnimationFrame((()=>requestAnimationFrame((()=>i()))))},$=()=>{let i=performance.getEntriesByType("navigation")[0];if(i&&i.responseStart>0&&i.responseStart<performance.now())return i},k=()=>$()?.activationStart??0,g=(i,e=-1)=>{let t=$(),r="navigate";return he>=0?r="back-forward-cache":t&&(document.prerendering||k()>0?r="prerender":document.wasDiscarded?r="restore":t.type&&(r=t.type.replace(/_/g,"-"))),{name:i,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:r}},N=new WeakMap;function j(i,e){return N.get(i)||N.set(i,new e),N.get(i)}var _=class{constructor(){f(this,"t");f(this,"i",0);f(this,"o",[])}h(e){if(e.hadRecentInput)return;let t=this.o[0],r=this.o.at(-1);this.i&&t&&r&&e.startTime-r.startTime<1e3&&e.startTime-t.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),this.t?.(e)}},R=(i,e,t={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(i)){let r=new PerformanceObserver((n=>{Promise.resolve().then((()=>{e(n.getEntries())}))}));return r.observe({type:i,buffered:!0,...t}),r}}catch{}},J=i=>{let e=!1;return()=>{e||(i(),e=!0)}},y=-1,ge=new Set,se=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,F=i=>{if(document.visibilityState==="hidden"){if(i.type==="visibilitychange")for(let e of ge)e();isFinite(y)||(y=i.type==="visibilitychange"?i.timeStamp:0,removeEventListener("prerenderingchange",F,!0))}},E=()=>{if(y<0){let i=k();y=(document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter((t=>t.name==="hidden"&&t.startTime>i))[0]?.startTime)??se(),addEventListener("visibilitychange",F,!0),addEventListener("prerenderingchange",F,!0),v((()=>{setTimeout((()=>{y=se()}))}))}return{get firstHiddenTime(){return y},onHidden(i){ge.add(i)}}},P=i=>{document.prerendering?addEventListener("prerenderingchange",(()=>i()),!0):i()},oe=[1800,3e3],K=(i,e={})=>{P((()=>{let t=E(),r,n=g("FCP"),o=R("paint",(l=>{for(let c of l)c.name==="first-contentful-paint"&&(o.disconnect(),c.startTime<t.firstHiddenTime&&(n.value=Math.max(c.startTime-k(),0),n.entries.push(c),r(!0)))}));o&&(r=h(i,n,oe,e.reportAllChanges),v((l=>{n=g("FCP"),r=h(i,n,oe,e.reportAllChanges),V((()=>{n.value=performance.now()-l.timeStamp,r(!0)}))})))}))},ae=[.1,.25],fe=(i,e={})=>{let t=E();K(J((()=>{let r,n=g("CLS",0),o=j(e,_),l=s=>{for(let a of s)o.h(a);o.i>n.value&&(n.value=o.i,n.entries=o.o,r())},c=R("layout-shift",l);c&&(r=h(i,n,ae,e.reportAllChanges),t.onHidden((()=>{l(c.takeRecords()),r(!0)})),v((()=>{o.i=0,n=g("CLS",0),r=h(i,n,ae,e.reportAllChanges),V((()=>r()))})),setTimeout(r))})))},me=0,U=1/0,w=0,xe=i=>{for(let e of i)e.interactionId&&(U=Math.min(U,e.interactionId),w=Math.max(w,e.interactionId),me=w?(w-U)/7+1:0)},D,ce=()=>D?me:performance.interactionCount??0,Oe=()=>{"interactionCount"in performance||D||(D=R("event",xe,{type:"event",buffered:!0,durationThreshold:0}))},le=0,H=class{constructor(){f(this,"u",[]);f(this,"l",new Map);f(this,"m");f(this,"p")}v(){le=ce(),this.u.length=0,this.l.clear()}L(){let e=Math.min(this.u.length-1,Math.floor((ce()-le)/50));return this.u[e]}h(e){if(this.m?.(e),!e.interactionId&&e.entryType!=="first-input")return;let t=this.u.at(-1),r=this.l.get(e.interactionId);if(r||this.u.length<10||e.duration>t.P){if(r?e.duration>r.P?(r.entries=[e],r.P=e.duration):e.duration===r.P&&e.startTime===r.entries[0].startTime&&r.entries.push(e):(r={id:e.interactionId,entries:[e],P:e.duration},this.l.set(r.id,r),this.u.push(r)),this.u.sort(((n,o)=>o.P-n.P)),this.u.length>10){let n=this.u.splice(10);for(let o of n)this.l.delete(o.id)}this.p?.(r)}}},ye=i=>{let e=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?i():(i=J(i),addEventListener("visibilitychange",i,{once:!0,capture:!0}),e((()=>{i(),removeEventListener("visibilitychange",i,{capture:!0})})))},de=[200,500],ve=(i,e={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;let t=E();P((()=>{Oe();let r,n=g("INP"),o=j(e,H),l=s=>{ye((()=>{for(let d of s)o.h(d);let a=o.L();a&&a.P!==n.value&&(n.value=a.P,n.entries=a.entries,r())}))},c=R("event",l,{durationThreshold:e.durationThreshold??40});r=h(i,n,de,e.reportAllChanges),c&&(c.observe({type:"first-input",buffered:!0}),t.onHidden((()=>{l(c.takeRecords()),r(!0)})),v((()=>{o.v(),n=g("INP"),r=h(i,n,de,e.reportAllChanges)})))}))},W=class{constructor(){f(this,"m")}h(e){this.m?.(e)}},ue=[2500,4e3],be=(i,e={})=>{P((()=>{let t=E(),r,n=g("LCP"),o=j(e,W),l=s=>{e.reportAllChanges||(s=s.slice(-1));for(let a of s)o.h(a),a.startTime<t.firstHiddenTime&&(n.value=Math.max(a.startTime-k(),0),n.entries=[a],r())},c=R("largest-contentful-paint",l);if(c){r=h(i,n,ue,e.reportAllChanges);let s=J((()=>{l(c.takeRecords()),c.disconnect(),r(!0)})),a=d=>{d.isTrusted&&(ye(s),removeEventListener(d.type,a,{capture:!0}))};for(let d of["keydown","click","visibilitychange"])addEventListener(d,a,{capture:!0});v((d=>{n=g("LCP"),r=h(i,n,ue,e.reportAllChanges),V((()=>{n.value=performance.now()-d.timeStamp,r(!0)}))}))}}))},pe=[800,1800],z=i=>{document.prerendering?P((()=>z(i))):document.readyState!=="complete"?addEventListener("load",(()=>z(i)),!0):setTimeout(i)},ke=(i,e={})=>{let t=g("TTFB"),r=h(i,t,pe,e.reportAllChanges);z((()=>{let n=$();n&&(t.value=Math.max(n.responseStart-k(),0),t.entries=[n],r(!0),v((()=>{t=g("TTFB",0),r=h(i,t,pe,e.reportAllChanges),r(!0)})))}))};var I=class{constructor(e){this.data={lcp:null,cls:null,inp:null,fcp:null,ttfb:null};this.sent=!1;this.timeout=null;this.onReadyCallback=null;this.onReadyCallback=e}initialize(){try{be(this.collectMetric.bind(this)),fe(this.collectMetric.bind(this)),ve(this.collectMetric.bind(this)),K(this.collectMetric.bind(this)),ke(this.collectMetric.bind(this)),this.timeout=setTimeout(()=>{this.sent||this.sendData()},2e4),window.addEventListener("beforeunload",()=>{this.sent||this.sendData()})}catch(e){console.warn("Error initializing web vitals tracking:",e)}}collectMetric(e){if(this.sent)return;let t=e.name.toLowerCase();this.data[t]=e.value,Object.values(this.data).every(n=>n!==null)&&this.sendData()}sendData(){this.sent||(this.sent=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.onReadyCallback&&this.onReadyCallback(this.data))}getData(){return{...this.data}}};var M=class{constructor(e,t){this.tracker=e,this.config=t}initialize(){document.addEventListener("click",this.handleClick.bind(this),!0)}handleClick(e){let t=e.target;this.config.trackButtonClicks&&this.isButton(t)&&this.trackButtonClick(t)}isButton(e){if(e.tagName==="BUTTON"||e.getAttribute("role")==="button")return!0;if(e.tagName==="INPUT"){let n=e.type?.toLowerCase();if(n==="submit"||n==="button")return!0}let t=e.parentElement,r=0;for(;t&&r<3;){if(t.tagName==="BUTTON"||t.getAttribute("role")==="button")return!0;t=t.parentElement,r++}return!1}trackButtonClick(e){let t=this.findButton(e);if(!t)return;let r={text:this.getElementText(t)};this.tracker.trackButtonClick(r)}findButton(e){if(e.tagName==="BUTTON"||e.getAttribute("role")==="button")return e;if(e.tagName==="INPUT"){let n=e.type?.toLowerCase();if(n==="submit"||n==="button")return e}let t=e.parentElement,r=0;for(;t&&r<3;){if(t.tagName==="BUTTON"||t.getAttribute("role")==="button")return t;t=t.parentElement,r++}return null}getElementText(e){return e.textContent?.trim().substring(0,100)||void 0}cleanup(){document.removeEventListener("click",this.handleClick.bind(this),!0)}};var A=class{constructor(e){this.tracker=e}initialize(){document.addEventListener("copy",this.handleCopy.bind(this))}handleCopy(){let e=window.getSelection();if(!e||e.isCollapsed)return;let r=e.toString().length;if(r===0)return;let n=e.anchorNode,o=n instanceof HTMLElement?n:n?.parentElement;if(!o)return;let l={textLength:r,sourceElement:o.tagName.toLowerCase()};this.tracker.trackCopy(l)}cleanup(){document.removeEventListener("copy",this.handleCopy.bind(this))}};var L=class{constructor(e,t){this.tracker=e,this.config=t}initialize(){document.addEventListener("submit",this.handleSubmit.bind(this),!0),document.addEventListener("change",this.handleChange.bind(this),!0)}handleSubmit(e){let t=e.target;if(t.tagName!=="FORM")return;let r={formId:t.id||"",formName:t.name||"",formAction:t.action||"",method:(t.method||"get").toUpperCase(),fieldCount:t.elements.length};this.tracker.trackFormSubmit(r)}handleChange(e){let t=e.target,r=t.tagName.toUpperCase();if(!["INPUT","SELECT","TEXTAREA"].includes(r))return;if(r==="INPUT"){let o=t.type?.toLowerCase();if(o==="hidden"||o==="password")return}let n={element:r.toLowerCase(),inputType:r==="INPUT"?t.type?.toLowerCase():void 0,inputName:t.name||t.id||"",formId:t.form?.id||void 0};this.tracker.trackInputChange(n)}};(async function(){let i=document.currentScript;if(!i){console.error("Could not find current script tag");return}let e=i.getAttribute("data-namespace")||"rybbit",t=`disable-${e}`;if(window.__RYBBIT_OPTOUT__||localStorage.getItem(t)!==null){window[e]={pageview:()=>{},event:()=>{},error:()=>{},trackOutbound:()=>{},identify:()=>{},setTraits:()=>{},clearUserId:()=>{},getUserId:()=>null,startSessionReplay:()=>{},stopSessionReplay:()=>{},isSessionReplayActive:()=>!1};return}let r=await ie(i);if(!r)return;let n=new C(r);r.enableWebVitals&&new I(a=>{n.trackWebVitals(a)}).initialize(),r.trackButtonClicks&&new M(n,r).initialize(),r.trackCopy&&new A(n).initialize(),r.trackFormInteractions&&new L(n,r).initialize(),r.trackErrors&&(window.addEventListener("error",s=>{n.trackError(s.error||new Error(s.message),{filename:s.filename,lineno:s.lineno,colno:s.colno})}),window.addEventListener("unhandledrejection",s=>{let a=s.reason instanceof Error?s.reason:new Error(String(s.reason));n.trackError(a,{type:"unhandledrejection"})}));let o=()=>n.trackPageview(),l=r.debounceDuration>0?te(o,r.debounceDuration):o;function c(){if(document.addEventListener("click",function(s){let a=s.target;for(;a&&a!==document.documentElement;){if(a.hasAttribute("data-rybbit-event")){let d=a.getAttribute("data-rybbit-event");if(d){let T={};for(let b of a.attributes)if(b.name.startsWith("data-rybbit-prop-")){let B=b.name.replace("data-rybbit-prop-","");T[B]=b.value}n.trackEvent(d,T)}break}a=a.parentElement}if(r.trackOutbound){let d=s.target.closest("a");d?.href&&re(d.href)&&n.trackOutbound(d.href,d.innerText||d.textContent||"",d.target||"_self")}}),r.autoTrackSpa){let s=history.pushState,a=history.replaceState;history.pushState=function(...d){s.apply(this,d),l(),n.onPageChange()},history.replaceState=function(...d){a.apply(this,d),l(),n.onPageChange()},window.addEventListener("popstate",()=>{l(),n.onPageChange()}),window.addEventListener("hashchange",()=>{l(),n.onPageChange()})}}window[r.namespace]={pageview:()=>n.trackPageview(),event:(s,a={})=>n.trackEvent(s,a),error:(s,a={})=>n.trackError(s,a),trackOutbound:(s,a="",d="_self")=>n.trackOutbound(s,a,d),identify:(s,a)=>n.identify(s,a),setTraits:s=>n.setTraits(s),clearUserId:()=>n.clearUserId(),getUserId:()=>n.getUserId(),startSessionReplay:()=>n.startSessionReplay(),stopSessionReplay:()=>n.stopSessionReplay(),isSessionReplayActive:()=>n.isSessionReplayActive()},c(),window.addEventListener("beforeunload",()=>{n.cleanup()}),r.autoTrackPageview&&n.trackPageview()})();})();
